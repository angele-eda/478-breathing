<!doctype html>
<html lang="en" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>4-7-8 Breathing Timer (Sleep & Calm) | Breath24</title>
  <meta name="description" content="Free 4-7-8 breathing timer: inhale 4 seconds, hold 7, exhale 8. A simple rhythm many people use for sleep and calming stress." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0b0f17" />

  <link rel="canonical" href="https://breath24.com/breathing/4-7-8-breathing/" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="4-7-8 Breathing Timer (Sleep & Calm) | Breath24" />
  <meta property="og:description" content="Inhale 4 ‚Ä¢ hold 7 ‚Ä¢ exhale 8 ‚Äî a classic breathing exercise for sleep and calm." />
  <meta property="og:url" content="https://breath24.com/breathing/4-7-8-breathing/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4-7-8 Breathing Timer | Breath24" />
  <meta name="twitter:description" content="Inhale 4 ‚Ä¢ hold 7 ‚Ä¢ exhale 8 ‚Äî simple timer for sleep and calm." />

  <style>
    :root{
      --bg:#070a12;
      --bg2:#0b0f17;
      --card: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);

      --a: rgba(126,231,194,.70); /* mint */
      --b: rgba(255,210,122,.65); /* amber */
      --c: rgba(99,102,241,.40);  /* indigo */

      --btn: rgba(255,255,255,.06);
      --btn2: rgba(255,255,255,.10);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --r: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1100px 650px at 20% 0%, rgba(126,231,194,.10), transparent 55%),
        radial-gradient(900px 550px at 90% 15%, rgba(255,210,122,.10), transparent 60%),
        radial-gradient(900px 600px at 55% 110%, rgba(99,102,241,.12), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}

    /* subtle breathing background overlay */
    .bgBreath{
      position: fixed;
      inset: 0;
      pointer-events:none;
      opacity: .9;
      background:
        radial-gradient(800px 500px at 50% 35%, rgba(126,231,194,.12), transparent 60%),
        radial-gradient(900px 600px at 70% 60%, rgba(255,210,122,.10), transparent 62%),
        radial-gradient(900px 650px at 30% 70%, rgba(99,102,241,.10), transparent 65%);
      filter: blur(0px);
      transform: scale(1);
    }

    .wrap{
      width: min(980px, calc(100% - 34px));
      margin: 0 auto;
      padding: 18px 0 44px;
      position: relative;
      z-index: 2;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 10px 4px 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .logo{
      width:36px;height:36px;border-radius:14px;
      background: linear-gradient(135deg, rgba(126,231,194,.35), rgba(255,210,122,.25));
      border:1px solid var(--line);
      box-shadow: 0 10px 28px rgba(0,0,0,.28);
      flex: 0 0 auto;
    }
    .brandTxt{min-width:0}
    .brandTxt h1{margin:0;font-size:16px;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brandTxt .sub{margin:2px 0 0;font-size:12px;color:var(--muted)}

    .nav{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--line);
      color: var(--muted);
      font-size: 13px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .pill:hover{background: rgba(255,255,255,.09); color: var(--text)}
    .langPill{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--line);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .langPill .globe{
      width: 28px; height: 28px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.88);
      font-size: 14px;
    }
    select{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      border:none; outline:none; background:transparent;
      color: rgba(255,255,255,.88);
      font-weight: 800;
      font-size: 13px;
      cursor:pointer;
      padding-right: 4px;
    }
    .caret{
      width: 26px; height: 26px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.65);
      user-select:none;
      font-weight: 900;
      font-size: 12px;
    }

    .panel{
      margin-top: 6px;
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
    }

    .head{
      padding: 16px 16px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      flex-wrap:wrap;
    }
    .title h2{margin:0;font-size:22px;letter-spacing:-0.02em}
    .title p{margin:6px 0 0;color:var(--muted);line-height:1.55}

    .content{
      padding: 6px 16px 16px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items: stretch;
    }

    .stage{
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 20px;
      background: rgba(0,0,0,.18);
      padding: 16px;
      position: relative;
      overflow:hidden;
      min-height: 320px;
    }

    .stageTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .phase{
      color: var(--muted);
      font-size: 13px;
      letter-spacing:.2px;
    }
    .round{
      color: var(--muted2);
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }

    .circleWrap{
      display:grid;
      place-items:center;
      margin-top: 8px;
    }

    .circle{
      width: min(360px, 70vw);
      aspect-ratio: 1/1;
      border-radius: 999px;
      position: relative;
      display:grid;
      place-items:center;
      transform: scale(1);
      will-change: transform, filter;
      filter: drop-shadow(0 18px 60px rgba(0,0,0,.55));
    }

    .circle::before{
      content:"";
      position:absolute;
      inset: 0;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 28%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(circle at 65% 70%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(circle at 50% 50%, rgba(126,231,194,.22), rgba(255,210,122,.10) 45%, rgba(99,102,241,.10) 75%, rgba(0,0,0,0) 78%);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.06),
        0 10px 50px rgba(0,0,0,.35);
      opacity: .95;
    }

    .ring{
      position:absolute;
      inset: -10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        conic-gradient(from 180deg, rgba(126,231,194,.35), rgba(255,210,122,.28), rgba(99,102,241,.25), rgba(126,231,194,.35));
      filter: blur(12px);
      opacity: .65;
      transform: scale(1);
    }

    .center{
      position: relative;
      z-index: 2;
      text-align:center;
      padding: 12px 10px;
    }
    .count{
      font-size: 56px;
      line-height: 1;
      font-weight: 800;
      letter-spacing:-0.02em;
      margin: 0;
    }
    .cue{
      margin-top: 8px;
      color: rgba(255,255,255,.78);
      font-weight: 700;
      letter-spacing:.2px;
    }
    .micro{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.45;
    }

    .barWrap{
      margin-top: 14px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(126,231,194,.85), rgba(255,210,122,.75));
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .btn{
      border:none;
      padding: 11px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.90);
      font-size: 13px;
      font-weight: 800;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.16)}
    .btn:active{transform: translateY(1px)}
    .btn[disabled]{opacity:.45; cursor:not-allowed}
    .btn.primary{
      background: linear-gradient(180deg, rgba(126,231,194,.18), rgba(255,255,255,.06));
      border-color: rgba(126,231,194,.22);
    }

    .side{
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 20px;
      background: rgba(0,0,0,.14);
      padding: 14px;
    }
    .side h3{
      margin: 0 0 10px;
      font-size: 14px;
      letter-spacing:.2px;
      color: rgba(255,255,255,.85);
    }
    .field{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding: 12px;
      margin-top: 10px;
    }
    label{display:block;font-size:12px;color: var(--muted);margin-bottom:8px}
    input[type="number"], input[type="range"], select.setting{
      width:100%;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.90);
      padding: 10px 10px;
      font-size: 14px;
      outline:none;
    }
    .row2{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-top: 8px;
      color: var(--muted);
      font-size: 12px;
    }
    .tiny{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.55;
      margin-top: 10px;
    }

    .more{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    .linkbtn{
      padding: 9px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 13px;
    }
    .linkbtn:hover{color: var(--text); background: rgba(255,255,255,.08)}

    footer{
      margin-top: 14px;
      padding: 14px 4px 0;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      border-top: 1px solid rgba(255,255,255,.10);
    }
    footer a{color: var(--muted); text-decoration: underline; text-underline-offset: 3px}
    footer a:hover{color: var(--text)}

    @media (max-width: 860px){
      .content{grid-template-columns: 1fr; }
      .stage{min-height: 340px}
    }
    @media (max-width: 520px){
      .count{font-size: 50px}
    }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"4-7-8 Breathing Timer",
    "url":"https://breath24.com/breathing/4-7-8-breathing/",
    "description":"Free 4-7-8 breathing timer: inhale 4 seconds, hold 7, exhale 8. Great for sleep and calming stress.",
    "isPartOf":{"@type":"WebSite","name":"Breath24","url":"https://breath24.com/"}
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"HowTo",
    "name":"4-7-8 Breathing",
    "description":"Inhale 4 seconds, hold 7 seconds, exhale 8 seconds.",
    "step":[
      {"@type":"HowToStep","name":"Inhale","text":"Inhale through your nose for 4 seconds."},
      {"@type":"HowToStep","name":"Hold","text":"Hold your breath for 7 seconds."},
      {"@type":"HowToStep","name":"Exhale","text":"Exhale slowly for 8 seconds."}
    ]
  }
  </script>
</head>

<body>
  <div class="bgBreath" id="bgBreath" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <a class="brand" href="/">
        <span class="logo" aria-hidden="true"></span>
        <span class="brandTxt">
          <h1>Breath24</h1>
          <div class="sub" id="t_sub">4-7-8 breathing</div>
        </span>
      </a>

      <nav class="nav">
        <a class="pill" href="/breathing/" id="t_navLibrary">Library</a>
        <a class="pill" href="/guide/" id="t_navGuide">Guide</a>
        <a class="pill" href="/about.html" id="t_navAbout">About</a>

        <div class="langPill" aria-label="language">
          <div class="globe">üåê</div>
          <select id="langSelect" aria-label="Select language">
            <option value="en">English</option>
            <option value="ko">ÌïúÍµ≠Ïñ¥</option>
            <option value="ja">Êó•Êú¨Ë™û</option>
            <option value="es">Espa√±ol</option>
          </select>
          <div class="caret">‚ñæ</div>
        </div>
      </nav>
    </header>

    <section class="panel">
      <div class="head">
        <div class="title">
          <h2 id="t_title">4-7-8 Breathing Timer</h2>
          <p id="t_desc">Inhale 4 ‚Ä¢ Hold 7 ‚Ä¢ Exhale 8. A simple rhythm many people use for sleep and calming stress.</p>
        </div>
      </div>

      <div class="content">
        <!-- MAIN STAGE -->
        <div class="stage">
          <div class="stageTop">
            <div class="phase" id="phaseLabel">Ready</div>
            <div class="round" id="roundLabel">Round 1/6</div>
          </div>

          <div class="circleWrap">
            <div class="circle" id="circle">
              <div class="ring" id="ring" aria-hidden="true"></div>
              <div class="center">
                <p class="count" id="count" aria-live="polite">‚Äî</p>
                <div class="cue" id="cue">Ready</div>
                <div class="micro" id="micro">Tap Start to begin.</div>
              </div>
            </div>
          </div>

          <div class="barWrap" aria-hidden="true"><div class="bar" id="bar"></div></div>

          <div class="row">
            <button class="btn primary" id="startBtn">‚ñ∂ Start</button>
            <button class="btn" id="pauseBtn" disabled>‚è∏ Pause</button>
            <button class="btn" id="resetBtn">‚Ü∫ Reset</button>
          </div>

          <div class="more" aria-label="More breathing timers">
            <a class="linkbtn" href="/breathing/" id="t_back">‚Üê Back to Library</a>
            <a class="linkbtn" href="/breathing/box-breathing/" id="t_more1">Box Breathing</a>
            <a class="linkbtn" href="/breathing/4-4-6-breathing/" id="t_more2">4-4-6 Breathing</a>
          </div>
        </div>

        <!-- SETTINGS -->
        <aside class="side">
          <h3 id="t_settings">Settings</h3>

          <div class="field">
            <label for="rounds" id="t_rounds">Rounds</label>
            <input id="rounds" type="number" min="1" max="50" value="6" inputmode="numeric" />
            <div class="row2">
              <span id="t_roundsHint">Recommended: 4‚Äì8 rounds</span>
              <span id="totalTime">‚Äî</span>
            </div>
          </div>

          <div class="field">
            <label for="soundMode" id="t_sound">Sound</label>
            <select class="setting" id="soundMode">
              <option value="off" id="t_soundOff">Off</option>
              <option value="soft" selected id="t_soundSoft">Soft</option>
              <option value="clear" id="t_soundClear">Clear</option>
            </select>

            <div class="row2">
              <span id="t_volume">Volume</span>
              <span id="volPct">60%</span>
            </div>
            <input id="volume" type="range" min="0" max="100" value="60" />
            <div class="tiny" id="t_soundNote">
              If you don‚Äôt hear beeps on iPhone/Safari, press Start once (audio unlock).
            </div>
          </div>

          <div class="field">
            <label id="t_tipTitle">Tip</label>
            <div class="tiny" id="t_tip">
              Keep shoulders relaxed. If you feel dizzy, stop and breathe normally.
            </div>
          </div>
        </aside>
      </div>
    </section>

    <footer>
      <div>¬© <span id="y"></span> Breath24</div>
      <div>
        <a href="/privacy.html" id="t_privacy">Privacy</a> ¬∑
        <a href="/terms.html" id="t_terms">Terms</a>
      </div>
    </footer>
  </div>

<script>
(() => {
  // ========== i18n ==========
  const I18N = {
    en: {
      sub: "4-7-8 breathing",
      navLibrary:"Library", navGuide:"Guide", navAbout:"About",
      title:"4-7-8 Breathing Timer",
      desc:"Inhale 4 ‚Ä¢ Hold 7 ‚Ä¢ Exhale 8. A simple rhythm many people use for sleep and calming stress.",
      settings:"Settings",
      rounds:"Rounds",
      roundsHint:"Recommended: 4‚Äì8 rounds",
      sound:"Sound",
      soundOff:"Off",
      soundSoft:"Soft",
      soundClear:"Clear",
      volume:"Volume",
      soundNote:"If you don‚Äôt hear beeps on iPhone/Safari, press Start once (audio unlock).",
      tipTitle:"Tip",
      tip:"Keep shoulders relaxed. If you feel dizzy, stop and breathe normally.",
      back:"‚Üê Back to Library",
      more1:"Box Breathing",
      more2:"4-4-6 Breathing",
      privacy:"Privacy",
      terms:"Terms",
      start:"‚ñ∂ Start",
      running:"‚èµ Running‚Ä¶",
      pause:"‚è∏ Pause",
      resume:"‚èµ Resume",
      reset:"‚Ü∫ Reset",
      ready:"Ready",
      done:"Done",
      microReady:"Tap Start to begin.",
      microFollow:"Follow the cue. If uncomfortable, pause or reset.",
      microPaused:"Paused. Resume when ready.",
      microDone:"Nice. Return to normal breathing for a moment.",
      cueReady:"Ready",
      cueInhale:"Inhale",
      cueHold:"Hold",
      cueExhale:"Exhale"
    },
    ko: {
      sub: "4-7-8 Ìò∏Ìù°",
      navLibrary:"ÎùºÏù¥Î∏åÎü¨Î¶¨", navGuide:"Í∞ÄÏù¥Îìú", navAbout:"ÏÜåÍ∞ú",
      title:"4-7-8 Ìò∏Ìù° ÌÉÄÏù¥Î®∏",
      desc:"Îì§Ïà® 4 ‚Ä¢ Î©àÏ∂§ 7 ‚Ä¢ ÎÇ†Ïà® 8. ÏàòÎ©¥Í≥º Í∏¥Ïû• ÏôÑÌôîÏóê ÎßéÏù¥ Ïì∞Îäî Í∞ÑÎã®Ìïú Î¶¨Îì¨ÏûÖÎãàÎã§.",
      settings:"ÏÑ§Ï†ï",
      rounds:"ÎùºÏö¥Îìú(Ìöå)",
      roundsHint:"Ï∂îÏ≤ú: 4‚Äì8Ìöå",
      sound:"ÏÜåÎ¶¨",
      soundOff:"ÎÅî",
      soundSoft:"Î∂ÄÎìúÎüΩÍ≤å",
      soundClear:"ÏÑ†Î™ÖÌïòÍ≤å",
      volume:"Î≥ºÎ•®",
      soundNote:"ÏïÑÏù¥Ìè∞/ÏÇ¨ÌååÎ¶¨ÏóêÏÑú ÏÜåÎ¶¨Í∞Ä Ïïà ÎÇòÎ©¥ StartÎ•º Ìïú Î≤à ÎàåÎü¨ Ïò§ÎîîÏò§Í∞Ä ÌôúÏÑ±ÌôîÎêòÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî.",
      tipTitle:"ÌåÅ",
      tip:"Ïñ¥Íπ® ÌûòÏùÑ ÎπºÍ≥† Ìé∏ÌïòÍ≤å. Ïñ¥ÏßÄÎü¨Ïö∞Î©¥ Ï§ëÎã®ÌïòÍ≥† ÌèâÏÜå Ìò∏Ìù°ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÏÑ∏Ïöî.",
      back:"‚Üê ÎùºÏù¥Î∏åÎü¨Î¶¨Î°ú",
      more1:"Î∞ïÏä§ Ìò∏Ìù°",
      more2:"4-4-6 Ìò∏Ìù°",
      privacy:"Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®",
      terms:"Ïù¥Ïö©ÏïΩÍ¥Ä",
      start:"‚ñ∂ ÏãúÏûë",
      running:"‚èµ ÏßÑÌñâÏ§ë‚Ä¶",
      pause:"‚è∏ ÏùºÏãúÏ†ïÏßÄ",
      resume:"‚èµ Ïû¨Í∞ú",
      reset:"‚Ü∫ Î¶¨ÏÖã",
      ready:"Ï§ÄÎπÑ",
      done:"ÏôÑÎ£å",
      microReady:"ÏãúÏûëÏùÑ ÎàåÎü¨ ÏãúÏûëÌïòÏÑ∏Ïöî.",
      microFollow:"ÌëúÏãúÎ•º Îî∞ÎùºÍ∞ÄÏÑ∏Ïöî. Î∂àÌé∏ÌïòÎ©¥ ÏùºÏãúÏ†ïÏßÄ ÎòêÎäî Î¶¨ÏÖã.",
      microPaused:"Ï†ïÏßÄÎê®. Ï§ÄÎπÑÎêòÎ©¥ Ïû¨Í∞úÌïòÏÑ∏Ïöî.",
      microDone:"Ï¢ãÏïÑÏöî. Ïû†Ïãú ÏûêÏó∞ Ìò∏Ìù°ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÏÑ∏Ïöî.",
      cueReady:"Ï§ÄÎπÑ",
      cueInhale:"Îì§Ïù¥ÎßàÏãúÍ∏∞",
      cueHold:"Î©àÏ∂§",
      cueExhale:"ÎÇ¥Ïâ¨Í∏∞"
    },
    ja: {
      sub: "4-7-8 ÂëºÂê∏",
      navLibrary:"„É©„Ç§„Éñ„É©„É™", navGuide:"„Ç¨„Ç§„Éâ", navAbout:"Ê¶ÇË¶Å",
      title:"4-7-8 ÂëºÂê∏„Çø„Ç§„Éû„Éº",
      desc:"Âê∏„ÅÜ 4 ‚Ä¢ Ê≠¢„ÇÅ„Çã 7 ‚Ä¢ Âêê„Åè 8„ÄÇÁù°Áú†„ÇÑËêΩ„Å°ÁùÄ„Åç„Å´‰Ωø„Çè„Çå„Çã„Ç∑„É≥„Éó„É´„Å™„É™„Ç∫„É†„Åß„Åô„ÄÇ",
      settings:"Ë®≠ÂÆö",
      rounds:"ÂõûÊï∞",
      roundsHint:"„Åä„Åô„Åô„ÇÅ: 4„Äú8Âõû",
      sound:"„Çµ„Ç¶„É≥„Éâ",
      soundOff:"„Ç™„Éï",
      soundSoft:"„ÇÑ„Åï„Åó„Åè",
      soundClear:"„ÅØ„Å£„Åç„Çä",
      volume:"Èü≥Èáè",
      soundNote:"iPhone/Safari„ÅßÈü≥„ÅåÂá∫„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅStart„Çí‰∏ÄÂ∫¶Êäº„Åó„Å¶„Ç™„Éº„Éá„Ç£„Ç™„ÇíÊúâÂäπÂåñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
      tipTitle:"„Éí„É≥„Éà",
      tip:"ËÇ©„ÅÆÂäõ„ÇíÊäú„ÅÑ„Å¶„ÄÇ„ÇÅ„Åæ„ÅÑ„ÇíÊÑü„Åò„Åü„Çâ‰∏≠Ê≠¢„Åó„Å¶ÈÄöÂ∏∏„ÅÆÂëºÂê∏„Å´Êàª„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
      back:"‚Üê „É©„Ç§„Éñ„É©„É™„Å∏",
      more1:"„Éú„ÉÉ„ÇØ„ÇπÂëºÂê∏",
      more2:"4-4-6 ÂëºÂê∏",
      privacy:"„Éó„É©„Ç§„Éê„Ç∑„Éº",
      terms:"Âà©Áî®Ë¶èÁ¥Ñ",
      start:"‚ñ∂ ÈñãÂßã",
      running:"‚èµ ÂÆüË°å‰∏≠‚Ä¶",
      pause:"‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢",
      resume:"‚èµ ÂÜçÈñã",
      reset:"‚Ü∫ „É™„Çª„ÉÉ„Éà",
      ready:"Ê∫ñÂÇô",
      done:"ÂÆå‰∫Ü",
      microReady:"Start„ÇíÊäº„Åó„Å¶ÈñãÂßã„ÄÇ",
      microFollow:"ÂêàÂõ≥„Å´Âêà„Çè„Åõ„Å¶„ÄÇÁÑ°ÁêÜ„Å™„ÇâÂÅúÊ≠¢/„É™„Çª„ÉÉ„Éà„ÄÇ",
      microPaused:"ÂÅúÊ≠¢‰∏≠„ÄÇÊ∫ñÂÇô„Åß„Åç„Åü„ÇâÂÜçÈñã„ÄÇ",
      microDone:"„ÅÑ„ÅÑ„Å≠„ÄÇ„Åó„Å∞„Çâ„ÅèËá™ÁÑ∂„Å™ÂëºÂê∏„Å∏„ÄÇ",
      cueReady:"Ê∫ñÂÇô",
      cueInhale:"Âê∏„ÅÜ",
      cueHold:"Ê≠¢„ÇÅ„Çã",
      cueExhale:"Âêê„Åè"
    },
    es: {
      sub: "Respiraci√≥n 4-7-8",
      navLibrary:"Biblioteca", navGuide:"Gu√≠a", navAbout:"Acerca de",
      title:"Temporizador de respiraci√≥n 4-7-8",
      desc:"Inhala 4 ‚Ä¢ Mant√©n 7 ‚Ä¢ Exhala 8. Un ritmo simple para dormir y calmar el estr√©s.",
      settings:"Ajustes",
      rounds:"Rondas",
      roundsHint:"Recomendado: 4‚Äì8 rondas",
      sound:"Sonido",
      soundOff:"Apagado",
      soundSoft:"Suave",
      soundClear:"Claro",
      volume:"Volumen",
      soundNote:"Si no oyes pitidos en iPhone/Safari, pulsa Start una vez (desbloqueo de audio).",
      tipTitle:"Consejo",
      tip:"Relaja los hombros. Si sientes mareo, detente y respira normal.",
      back:"‚Üê Volver a la biblioteca",
      more1:"Respiraci√≥n en caja",
      more2:"Respiraci√≥n 4-4-6",
      privacy:"Privacidad",
      terms:"T√©rminos",
      start:"‚ñ∂ Iniciar",
      running:"‚èµ Ejecutando‚Ä¶",
      pause:"‚è∏ Pausa",
      resume:"‚èµ Reanudar",
      reset:"‚Ü∫ Reiniciar",
      ready:"Listo",
      done:"Hecho",
      microReady:"Pulsa Start para comenzar.",
      microFollow:"Sigue la se√±al. Si no es c√≥modo, pausa o reinicia.",
      microPaused:"En pausa. Reanuda cuando quieras.",
      microDone:"Bien. Vuelve a respirar normal un momento.",
      cueReady:"Listo",
      cueInhale:"Inhala",
      cueHold:"Mant√©n",
      cueExhale:"Exhala"
    }
  };

  const els = {
    sub: document.getElementById('t_sub'),
    navLibrary: document.getElementById('t_navLibrary'),
    navGuide: document.getElementById('t_navGuide'),
    navAbout: document.getElementById('t_navAbout'),
    title: document.getElementById('t_title'),
    desc: document.getElementById('t_desc'),
    settings: document.getElementById('t_settings'),
    rounds: document.getElementById('t_rounds'),
    roundsHint: document.getElementById('t_roundsHint'),
    sound: document.getElementById('t_sound'),
    soundOff: document.getElementById('t_soundOff'),
    soundSoft: document.getElementById('t_soundSoft'),
    soundClear: document.getElementById('t_soundClear'),
    volume: document.getElementById('t_volume'),
    soundNote: document.getElementById('t_soundNote'),
    tipTitle: document.getElementById('t_tipTitle'),
    tip: document.getElementById('t_tip'),
    back: document.getElementById('t_back'),
    more1: document.getElementById('t_more1'),
    more2: document.getElementById('t_more2'),
    privacy: document.getElementById('t_privacy'),
    terms: document.getElementById('t_terms'),
  };

  const langSelect = document.getElementById('langSelect');

  function detectLang(){
    const qs = new URLSearchParams(location.search);
    const q = (qs.get('lang') || '').toLowerCase();
    if (I18N[q]) return q;
    const saved = (localStorage.getItem('b24_lang') || '').toLowerCase();
    if (I18N[saved]) return saved;
    const nav = (navigator.language || 'en').toLowerCase();
    if (nav.startsWith('ko')) return 'ko';
    if (nav.startsWith('ja')) return 'ja';
    if (nav.startsWith('es')) return 'es';
    return 'en';
  }

  let L = detectLang();
  function setLang(lang, {pushUrl=true} = {}){
    if (!I18N[lang]) lang = 'en';
    L = lang;
    localStorage.setItem('b24_lang', lang);
    document.documentElement.lang = lang;
    langSelect.value = lang;

    const t = I18N[lang];
    els.sub.textContent = t.sub;
    els.navLibrary.textContent = t.navLibrary;
    els.navGuide.textContent = t.navGuide;
    els.navAbout.textContent = t.navAbout;
    els.title.textContent = t.title;
    els.desc.textContent = t.desc;
    els.settings.textContent = t.settings;
    els.rounds.textContent = t.rounds;
    els.roundsHint.textContent = t.roundsHint;
    els.sound.textContent = t.sound;
    els.soundOff.textContent = t.soundOff;
    els.soundSoft.textContent = t.soundSoft;
    els.soundClear.textContent = t.soundClear;
    els.volume.textContent = t.volume;
    els.soundNote.textContent = t.soundNote;
    els.tipTitle.textContent = t.tipTitle;
    els.tip.textContent = t.tip;
    els.back.textContent = t.back;
    els.more1.textContent = t.more1;
    els.more2.textContent = t.more2;
    els.privacy.textContent = t.privacy;
    els.terms.textContent = t.terms;

    // dynamic labels
    startBtn.textContent = t.start;
    pauseBtn.textContent = t.pause;
    resetBtn.textContent = t.reset;

    if (pushUrl){
      const url = new URL(location.href);
      url.searchParams.set('lang', lang);
      history.replaceState({}, "", url.toString());
    }

    // update cue text to current phase immediately
    refreshPhaseText();
    refreshRoundLabel();
    updateMicroText();
  }

  langSelect.addEventListener('change', (e) => setLang(e.target.value, {pushUrl:true}));

  // ========== timer / animation ==========
  const pattern = [
    { key:"inhale", seconds:4 },
    { key:"hold",   seconds:7 },
    { key:"exhale", seconds:8 }
  ];

  const circle = document.getElementById('circle');
  const ring = document.getElementById('ring');
  const bgBreath = document.getElementById('bgBreath');

  const phaseLabel = document.getElementById('phaseLabel');
  const roundLabel = document.getElementById('roundLabel');
  const countEl = document.getElementById('count');
  const cueEl = document.getElementById('cue');
  const microEl = document.getElementById('micro');
  const bar = document.getElementById('bar');

  const roundsInput = document.getElementById('rounds');
  const totalTime = document.getElementById('totalTime');

  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');

  const soundMode = document.getElementById('soundMode');
  const volume = document.getElementById('volume');
  const volPct = document.getElementById('volPct');

  let running = false;
  let paused = false;

  let round = 1;
  let phaseIdx = 0;

  // phase timing
  let phaseStartTs = 0;
  let pauseStartTs = 0;
  let pausedAccum = 0;

  // audio
  let audioCtx = null;
  function ensureAudio(){
    if (!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
  }
  function beep(){
    const mode = soundMode.value;
    if (mode === 'off') return;
    ensureAudio();

    const v = (parseInt(volume.value,10) || 0) / 100;
    if (v <= 0) return;

    const freq = (mode === 'clear') ? 1046.5 : 880; // C6 vs A5
    const dur = (mode === 'clear') ? 0.09 : 0.07;

    try{
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();

      o.type = "sine";
      o.frequency.value = freq;

      // small envelope to avoid click
      const now = audioCtx.currentTime;
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(Math.max(0.0002, 0.06 * v), now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

      o.connect(g);
      g.connect(audioCtx.destination);
      o.start(now);
      o.stop(now + dur + 0.02);
    }catch(e){}
  }

  function maxRounds(){
    return Math.max(1, parseInt(roundsInput.value || '1', 10));
  }

  function totalSecondsPerRound(){
    return pattern.reduce((sum,p)=>sum+p.seconds,0);
  }
  function updateTotalTime(){
    const s = totalSecondsPerRound() * maxRounds();
    const m = Math.floor(s/60);
    const r = s % 60;
    totalTime.textContent = m>0 ? `${m}m ${String(r).padStart(2,'0')}s` : `${r}s`;
  }

  function phaseKey(){
    return pattern[phaseIdx].key;
  }
  function phaseSeconds(){
    return pattern[phaseIdx].seconds;
  }

  function t(){
    return I18N[L] || I18N.en;
  }

  function refreshPhaseText(){
    const tt = t();
    const key = phaseKey();
    const cueMap = { inhale: tt.cueInhale, hold: tt.cueHold, exhale: tt.cueExhale };
    const cue = running ? (cueMap[key] || tt.cueReady) : tt.cueReady;

    cueEl.textContent = cue;

    if (!running){
      phaseLabel.textContent = tt.ready;
      return;
    }
    phaseLabel.textContent = cue;
  }

  function refreshRoundLabel(){
    roundLabel.textContent = `${(t().navLibrary === "ÎùºÏù¥Î∏åÎü¨Î¶¨") ? "Round" : "Round"} ${round}/${maxRounds()}`;
    // ÏúÑÎäî ÏùºÎ∂Ä Ïñ∏Ïñ¥ÏóêÏÑú Round Î≤àÏó≠ÍπåÏßÄ ÌïòÍ≥† Ïã∂ÏúºÎ©¥ Î∞îÍøîÎèÑ Îê®(ÌòÑÏû¨Îäî ÌÜµÏùº)
  }

  function updateMicroText(){
    const tt = t();
    if (!running){
      microEl.textContent = tt.microReady;
    } else if (paused){
      microEl.textContent = tt.microPaused;
    } else {
      microEl.textContent = tt.microFollow;
    }
  }

  function setButtons(){
    const tt = t();
    if (!running){
      startBtn.disabled = false;
      startBtn.textContent = tt.start;
      pauseBtn.disabled = true;
      pauseBtn.textContent = tt.pause;
    }else{
      pauseBtn.disabled = false;
      if (paused){
        startBtn.disabled = false;
        startBtn.textContent = tt.resume;
        pauseBtn.textContent = tt.resume;
      }else{
        startBtn.disabled = true;
        startBtn.textContent = tt.running;
        pauseBtn.textContent = tt.pause;
      }
    }
    resetBtn.textContent = tt.reset;
  }

  function stopUI(completed=false){
    const tt = t();
    running = false;
    paused = false;

    countEl.textContent = "‚Äî";
    bar.style.width = "0%";

    cueEl.textContent = tt.cueReady;
    phaseLabel.textContent = completed ? tt.done : tt.ready;
    microEl.textContent = completed ? tt.microDone : tt.microReady;

    // reset visuals
    circle.style.transform = `scale(1)`;
    ring.style.transform = `scale(1)`;
    ring.style.opacity = `.55`;
    bgBreath.style.transform = `scale(1)`;
    bgBreath.style.opacity = `.9`;

    setButtons();
    refreshRoundLabel();
  }

  function start(){
    // iOS/Safari: user gesture unlock
    ensureAudio();

    if (!running){
      round = 1;
      phaseIdx = 0;
      pausedAccum = 0;
      phaseStartTs = performance.now();
    } else if (paused){
      // resume: adjust accumulated pause time
      const now = performance.now();
      pausedAccum += (now - pauseStartTs);
      paused = false;
    } else {
      return;
    }

    running = true;
    paused = false;

    // phase-change beep on start as a gentle cue (optional)
    // beep();

    setButtons();
    refreshPhaseText();
    refreshRoundLabel();
    updateMicroText();
  }

  function togglePause(){
    if (!running) return;
    paused = !paused;
    if (paused){
      pauseStartTs = performance.now();
    } else {
      const now = performance.now();
      pausedAccum += (now - pauseStartTs);
    }
    setButtons();
    refreshPhaseText();
    refreshRoundLabel();
    updateMicroText();
  }

  function reset(){
    stopUI(false);
  }

  function nextPhase(){
    beep(); // ‚úÖ phase change beep

    phaseIdx++;
    if (phaseIdx >= pattern.length){
      phaseIdx = 0;
      round++;
    }
    if (round > maxRounds()){
      stopUI(true);
      return false;
    }
    phaseStartTs = performance.now();
    pausedAccum = 0;
    refreshPhaseText();
    refreshRoundLabel();
    return true;
  }

  // smooth easing: 0..1 -> smooth in/out
  function easeInOutSine(x){
    return -(Math.cos(Math.PI * x) - 1) / 2;
  }

  // main render loop
  function rafLoop(){
    requestAnimationFrame(rafLoop);

    if (!running){
      // idle: tiny float to feel alive
      const k = (performance.now() / 1000);
      const idle = 1 + Math.sin(k * 1.2) * 0.006;
      circle.style.transform = `scale(${idle.toFixed(4)})`;
      ring.style.transform = `scale(${(idle*1.02).toFixed(4)})`;
      return;
    }
    if (paused) return;

    const now = performance.now();
    const elapsed = (now - phaseStartTs - pausedAccum) / 1000;
    const dur = phaseSeconds();

    let p = dur > 0 ? (elapsed / dur) : 1;
    if (p >= 1){
      // snap to end UI, then advance phase
      p = 1;
    }

    // countdown: show remaining seconds (ceil)
    const remain = Math.max(0, Math.ceil(dur - elapsed));
    countEl.textContent = String(remain);

    // progress bar
    const pct = Math.max(0, Math.min(1, p));
    bar.style.width = `${(pct * 100).toFixed(1)}%`;

    // BREATHING SCALE based on phase
    const key = phaseKey();
    let scale = 1.0;
    let glow = 0.55;
    let bgScale = 1.0;
    let bgOp = 0.9;

    if (key === "inhale"){
      // grow: slow->fast->slow
      const e = easeInOutSine(pct);
      scale = 1.00 + e * 0.22;     // up to +22%
      glow  = 0.48 + e * 0.32;
      bgScale = 1.00 + e * 0.03;
      bgOp = 0.88 + e * 0.10;
    } else if (key === "hold"){
      // subtle micro movement
      const wobble = Math.sin((performance.now()/1000)*2.2) * 0.004;
      scale = 1.22 + wobble;
      glow  = 0.80;
      bgScale = 1.03 + wobble*0.3;
      bgOp = 0.98;
    } else if (key === "exhale"){
      // shrink: long smooth release (use ease)
      const e = easeInOutSine(pct);
      scale = 1.22 - e * 0.22;     // back to 1.00
      glow  = 0.80 - e * 0.28;
      bgScale = 1.03 - e * 0.03;
      bgOp = 0.98 - e * 0.10;
    }

    circle.style.transform = `scale(${scale.toFixed(4)})`;
    ring.style.transform = `scale(${(scale*1.05).toFixed(4)})`;
    ring.style.opacity = `${glow.toFixed(3)}`;
    bgBreath.style.transform = `scale(${bgScale.toFixed(4)})`;
    bgBreath.style.opacity = `${bgOp.toFixed(3)}`;

    // update labels
    refreshPhaseText();
    updateMicroText();
    refreshRoundLabel();

    // phase finish
    if (elapsed >= dur){
      // advance phase
      nextPhase();
    }
  }

  // events
  startBtn.addEventListener('click', start);
  pauseBtn.addEventListener('click', togglePause);
  resetBtn.addEventListener('click', reset);

  roundsInput.addEventListener('change', () => {
    updateTotalTime();
    refreshRoundLabel();
  });

  volume.addEventListener('input', () => {
    volPct.textContent = `${volume.value}%`;
  });

  soundMode.addEventListener('change', () => {
    // optional: play a tiny confirmation beep when sound is enabled
    if (soundMode.value !== 'off') beep();
  });

  // init
  document.getElementById('y').textContent = new Date().getFullYear();
  volPct.textContent = `${volume.value}%`;
  updateTotalTime();

  setLang(L, {pushUrl:true});
  stopUI(false);
  requestAnimationFrame(rafLoop);
})();
</script>
</body>
</html>